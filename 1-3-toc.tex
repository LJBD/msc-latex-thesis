\section{Regulacja czasooptymalna}
\label{sec:toc}

W niniejszym podrozdziale przedstawiona zostanie koncepcja regulacji czasooptymalnej. Zostaną podane założenia zagadnienia, twierdzenia, na których podstawie można wyliczyć rozwiązanie oraz jego proponowana forma analityczna.

Zaznacza się, że mimo iż podane niżej definicje i założenia są wzięte z ogólnych zagadnień optymalizacji dynamicznej, to w podanym brzmieniu stosują się tylko do zagadnienia wyznaczania sterowania czasooptymalnego.

%-------------------------------------------------
\subsection{Ogólna definicja zagadnienia}
\label{sub:toc-def}

%-------------------
\subsubsection{Założenia wstępne}
\label{sub:toc-def-intro}
Przyjmijmy system dany stacjonarnym, zwyczajnym równaniem różniczkowym (pokazanym jako równanie \ref{eq:general_system}), w którym:

\begin{equation}\label{eq:general_system}
    \frac{\partial x(t)}{\partial t} = f(x(t), u(t)), ~ 0 \leq t \leq T
\end{equation}

\begin{itemize}
    \item wektor zmiennych stanu w chwili $t$ - $x(t)$ spełnia następujące założenia:
    \begin{itemize}
        \item $\forall_{t \geq 0}:~ x(t) \in \mathbb{R}^{n}$ - ma $n$ składowych, a więc rozważany system ma $n$ równań różniczkowych zwyczajnych,
        \item $x(0) = x_{0} \in \mathbb{R}^{n}$ - spełnia warunek początkowy $x_{0}$;
    \end{itemize}
    \item wektor sterowań w chwili $t$ - $u(t)$:
    \begin{itemize}
        \item $\forall_{t \geq 0}:~ u(t) \in D \subset \mathbb{R}^{m}$ - ma $m$ składowych zawierającym się w zbiorze $D$ ograniczającym wartości sterowań,
        \item $u(0) = u_{0}$ - spełnia warunek początkowy $u_{0}$,
        \item funkcja $u$ jest przedziałami ciągła na przedziale $[0, T]$, czyli:
        \begin{itemize}
            \item ma co najwyżej skończoną liczbę punktów nieciągłości,
            \item w każdym z nich ma skończoną granicę lewostronną,
            \item jest prawostronnie ciągła,
            \item w lewym końcu przedziału jest lewostronnie ciągła;
        \end{itemize}
    \end{itemize}
    \item funkcja $f: \mathbb{R}^{n} \times \mathbb{R}^{m} \longmapsto \mathbb{R}^{n}$:
    \begin{itemize}
        \item $f \in C^{1}$ - jest ciągła i różniczkowalna ze względu na pierwszy argument,
        \item $\frac{\partial f(t)}{\partial x} \in C^{0}$ - jej pochodna ze względu na pierwszy argument jest ciągła.
    \end{itemize}
\end{itemize}

Rozwiązaniem takiego równania jest oczywiście funkcja $x: [0, T) \longmapsto \mathbb{R}^{n}$ nazywana \emph{trajektorią układu}.

Trajektoria będąca rozwiązaniem zagadnienia minimalnoczasowego musi spełniać następujący warunek końcowy (nazywany również stanem docelowym):
\begin{equation}\label{eq:final_term}
    x(T) = x_{f} \in \mathbb{R}^{n}
\end{equation}

Ów czas $T$, po którym przy danym sterowaniu stan systemu osiągnie warunek końcowy, będzie wskaźnikiem jakości: 
\begin{equation}\label{eq:quality}
    Q(u(t)) = q(x_{f}) = T
\end{equation}

Na tej podstawie można określić \emph{sterowanie optymalne} $\hat{u}(t)$, które spełnia wszystkie wspominane przy opisie równania \ref{eq:general_system} warunki oraz zależność \ref{eq:optimal_quality}. Trajektoria układu wygenerowana przez zastosowanie sterowania optymalnego nazwana jest \emph{trajektorią optymalną} i opisana symbolem $\hat{x}(t)$.
\begin{equation}\label{eq:optimal_quality}
    \forall_{u(t)}:~ Q(u(t)) \leq Q(\hat{u}(t))
\end{equation}

W opisie zagadnienia czasooptymalnego potrzebne są jeszcze dwa pojęcia.
Pierwsze to \emph{funkcja sprzężona} $\psi: [0, T] \longmapsto \mathbb{R}^{n}$ będąca rozwiązaniem tzw. równania sprzężonego \ref{eq:costate-def}.
\begin{equation}\label{eq:costate-def}
\frac{\partial \psi(t)}{\partial t} = - \frac{\partial f(x(t), u(t)}{\partial x}
\end{equation}

Tak, jak w przypadku trajektorii optymalnej układu, trajektoria $\psi(t)$ wyznaczona w układzie, w którym zastosowane zostało sterowanie optymalne $\hat{u}(t)$, nosi nazwę \emph{trajektorii sprzężonej optymalnej} i oznaczona jest symbolem $\hat{\psi}(t)$.

Ostatnim pojęciem potrzebnym w niniejszym zagadnieniu jest \emph{hamiltonian}, zwany również \emph{funkcją Hamiltona}, czyli funkcja $H: \mathbb{R}^{n} \times \mathbb{R}^{n} \times \mathbb{R}^{m} \longmapsto \mathbb{R}$ który dla trajektorii układu $x(t)$ wygenerowanej przy pomocy sterowania $u(t)$ i odpowiadającej im trajektorii sprzężonej $\psi(t)$ zdefiniowany jest zależnością \ref{eq:hamiltonian-def}.

\begin{equation}\label{eq:hamiltonian-def}
H(\psi(t), x(t), u(t)) = \psi(t) \circ f(x(t), u(t)) = \psi(t)^{T} \cdot f(x(t), u(t))
\end{equation}

%-------------------
\subsubsection{Zasada maksimum Pontriagina}
\label{sub:toc-def-pontriagin}

Aby jednoznacznie opisać, a następnie wyznaczyć sterowanie czasooptymalne, potrzebne jest przytoczenie zasadniczego twierdzenia w optymalizacji dynamicznej. Jest ono znane pod nazwą \emph{zasada maksimum Pontriagina}. Zostało opracowane w 1956 r. przez rosyjskiego matematyka Lwa Pontriagina.

\begin{pontriagin-max}\label{the:pontryagin}
    Zakładając układ opisany równaniem \ref{eq:general_system} z warunkiem końcowym \ref{eq:final_term} i wskaźnikiem jakości \ref{eq:quality} oraz równanie sprzężone \ref{eq:costate-def}:\\
    jeśli dla trajektorii układu $\hat{x}(t)$ wygenerowanej przy pomocy sterowania $\hat{u}(t)$ i odpowiadającej im trajektorii sprzężonej $\hat{\psi}(t)$ zachodzi:\\
    \begin{equation}\label{eq:pontriagin}
    \forall_{u(t) \in D}~ \forall_{t \in [0, T]}:~ H(\hat{\psi}(t), \hat{x}(t), \hat{u}(t)) ~ \geq ~ H(\hat{\psi}(t), \hat{x}(t), u(t))
    \end{equation}
    to sterowanie $\hat{u}(t)$ jest sterowaniem optymalnym.
\end{pontriagin-max}

Powyższe twierdzenie należy obwarować dodatkowymi warunkami koniecznymi optymalności. Niech funkcja $g: \mathbb{R}^{2n} \longmapsto \mathbb{R}^{l}$ opisuje zestaw ograniczeń nierównościowych, a funkcja $h: \mathbb{R}^{2n} \longmapsto \mathbb{R}^{k}$ - ograniczeń równościowych. Obie dane są wzorem \ref{eq:pontryagin-constraints}. Dodatkowo zakłada się, że $g, h \in C^{1}$.
\begin{equation}\label{eq:pontryagin-constraints}
    \begin{array}{lr}
    g(x_{0}, x_{f}) \leq 0 \\
    h(x_{0}, x_{f}) = 0
    \end{array}
\end{equation}

Ponadto, zakłada się, że istnieją $\lambda \in \mathbb{R}$, $\mu \in \mathbb{R}^{l}$ oraz $\rho \in \mathbb{R}^{k}$, które wraz z uprzednio zdefiniowanymi wielkościami i funkcjami spełniają następujące \emph{warunki konieczne optymalności}:
\begin{itemize}
    \item warunek nieujemności:
    \begin{equation}\label{eq:pontryagin-noneg}
    \lambda \geq 0 \land \|\mu\| \geq 0
    \end{equation}
    \item warunek nietrywialności:
    \begin{equation}\label{eq:pontryagin-notriv}
    \lambda + \|\mu\| + \|\rho\| > 0
    \end{equation}
    \item warunek komplementarności:
    \begin{equation}\label{eq:pontryagin-comp}
    \mu \circ g(x_{0}, x_{f}) = 0
    \end{equation}
    \item warunki transwersalności:
    \begin{equation}\label{eq:pontryagin-trans}
    \begin{array}{lr}
        \hat{\psi}(0) = \frac{\partial (\mu \circ g + \rho \circ h)}{\partial x_{0}}\\[8pt]
        \hat{\psi}(T) = - \frac{\partial (\mu \circ g + \rho \circ h)}{\partial x_{f}}\\[8pt]
        \forall_{t \in [0, T]}:~ H(\psi(t), x(t), u(t)) = \frac{\partial (\lambda T + \mu \circ g + \rho \circ h)}{\partial T} = \lambda
    \end{array}
    \end{equation}
    \item równanie sprzężone dane wzorem \ref{eq:costate-def},
    \item warunek maksimum hamiltonianu dany wzorem \ref{eq:pontriagin}.
\end{itemize}

%-------------------------------------------------
\subsection{Wyznaczanie sterowania czasooptymalnego}
\label{sub:toc-ctrl}

Analityczne rozwiązania poszukiwania sterowania czasooptymalnego zwykle opierają się bezpośrednio na przytoczonej powyżej zasadzie maksimum i warunkach koniecznych optymalności. W niniejszym podrozdziale zostanie pokrótce przedstawiona droga mogąca zmierzać do wyznaczenia analitycznego czasooptymalnego sterowania w rozważanym układzie zbiorników. Całe rozwiązanie nie jest przeprowadzone ze względu na fakt, iż równiania sprzężone są niestacjonarne, a więc ich rozwiązanie analityczne byłoby bardzo trudne lub wręcz niemożliwe.

Aby dodatkowo uprościć analizę problemu oraz fizyczne zastosowanie wyznaczonego sterowania, zakłada się, że poszukiwane jego postaci będą klasy "bang - bang". To znaczy, że będą przyjmowały tylko wartości z brzegów zbioru dopuszczalnego $D$. Można przyjąć takie założenie, ze względu na to, iż:
\begin{itemize}
    \item sterowanie $u$ jest jednowymiarowe: $D \in \mathbb{R} \Rightarrow D = [0, u_{max}]$,
    \item %TODO: dopisać dlaczego można stosować sterowanie bang-bang
\end{itemize}

Pierwszym krokiem ku wyliczeniu analitycznego rozwiązania jest wyznaczenie równań sprzężonych za pomocą wzoru \ref{eq:costate-def}. Przyjmując współczynniki $\alpha_{i} = \frac{1}{2} \forall_{i \in \{1, 2, 3\}}$ w modelu matematycznym zestawu zbiorników danym równaniem \ref{eq:model}, można wyznaczyć równania sprzężone rozważanego układu. Są one dane wzorem \ref{eq:sprzezone}. Pominięto w nim zależności wszystkich funkcji $\psi$ oraz $h$ od czasu, aby uprościć zapis.

\begin{equation}\label{eq:sprzezone}
	\left \{
	\begin{array}{lr}
		\frac{\partial \psi_{1}}{\partial t} =  \psi_{1}\frac{C_{1}}{2aw\sqrt{h_{1}}} - \psi_{2}\frac{C_{1}}{2\sqrt{h_{1}}(cw + \frac{h_{2}}{h_{max}}bw)} \\[20pt]
		\frac{\partial \psi_{2}}{\partial t} = - \psi_{2}\frac{1}{cw + \frac{h_{2}}{h_{max}}bw}(\frac{b(C_{1}\sqrt{h_{1}} - C_{2}\sqrt{h_{2}})}{ch_{max} + bh_{2}} - \frac{C_{2}}{2\sqrt{h_{2}}}) - \psi_{3}\frac{1}{w\sqrt{h_{3}(2R - h_{3})}} \\[20pt]
		\frac{\partial \psi_{3}}{\partial t} = \psi_{3}\frac{-C_{3}(3R - 2h_{3})}{wh_{3}(2R - h_{3})^{\frac{3}{2}}}
	\end{array}
	\right.
\end{equation}

Następnie trzeba by przedefiniować ograniczenia równościowe (dane wzorem \ref{eq:model-eq-const}) i nierównościowe (\ref{eq:model-noneq-const}) tak, aby spełniały założenia funkcji $g$ i $h$ opisane zależnościami \ref{eq:pontryagin-constraints}.
Korzystając z warunków komplementarności (\ref{eq:pontryagin-comp}) oraz nieujemności (\ref{eq:pontryagin-noneg}), powinno się wyznaczyć składowe wektora $\mu$ oraz założyć pewną postać wektora $\rho$.
%TODO: sprawdzic, czy rzeczywiście nie da się wyznaczyć 

Na podstawie tych danych należałoby wyznaczyć warunki początkowy i końcowy danym wzorem \ref{eq:pontryagin-trans} dla powyższych równań sprzężonych, co pozwoliłoby wyznaczyć analityczne wzory opisujące wszystkie składowe trajektorii sprzężonych systemu.


%-------------------------------------------------
\subsection{Nieliniowość układu a sterowanie czasooptymalne}
\label{sub:toc-nonlnr}


%-------------------------------------------------
\subsection{Numeryczne metody wyznaczania sterowania czasooptymalnego}
\label{sub:toc-num}